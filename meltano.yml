version: 1
send_anonymous_usage_stats: true
project_id: tap-mongodb
default_environment: test
environments:
  - name: test
plugins:
  extractors:
    - name: tap-mongodb
      namespace: tap_mongodb
      pip_url: -e .
      capabilities:
        - state
        - catalog
        - discover
        - about
        - stream-maps
      config:
        mongodb_connection_string: mongodb://admin:password@localhost:27017/
        database_includes:
          - database: test-database
            collection: TestDocument
      settings:
        - name: mongodb_connection_string
          kind: password
          description: |
            MongoDB connection string. See
            https://www.mongodb.com/docs/manual/reference/connection-string/#connection-string-uri-format for specification.
        - name: mongodb_connection_string_file
          kind: file
          description: Path to a file containing a MongoDB connection string URI.
        - name: prefix
          kind: string
          description: |
            An optional prefix which will be added to each stream name.
          value: ''
        - name: start_date
          kind: date_iso8601
          description: |
            Start date - used for incremental replication only. Log based replication does not support this setting - do
            not provide it unless you are using incremental replication. Defaults to epoch zero time `1970-01-01` if
            tap uses incremental replication method.
        - name: database_includes
          kind: array
          description: |
            A list of objects, each specifying `database` and `collection` name, to be included in tap output.
        - name: add_record_metadata
          kind: boolean
          description: |
            When True, _sdc metadata fields will be added to records produced by this tap.
        - name: allow_modify_change_streams
          kind: boolean
          description: |
            In DocumentDB (unlike MongoDB), change streams must be enabled specifically (see
            https://docs.aws.amazon.com/documentdb/latest/developerguide/change_streams.html#change_streams-enabling
            ). If attempting to open a change stream against a collection on which change streams have not been
            enabled, an OperationFailure error will be raised. If this property is set to True, when this error
            is seen, the tap will execute an admin command to enable change streams and then retry the read
            operation. Note: this may incur new costs in AWS DocumentDB.
        - name: operation_types
          kind: array
          description: |
            List of MongoDB change stream operation types to include in tap output. The default behavior is to
            limit to document-level operation types. See full list of operation types at
            https://www.mongodb.com/docs/manual/reference/change-events/#operation-types. Note that the list
            of allowed_values for this property includes some values not available to all MongoDB versions.
          value:
            - create
            - delete
            - insert
            - replace
            - update
      metadata:
        '*':
          replication-key: _id
          replication-method: INCREMENTAL
  loaders:
    - name: target-jsonl
      variant: andyh1203
      pip_url: target-jsonl
